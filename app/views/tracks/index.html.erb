<h1>Listing tracks</h1>
<%= render 'form' %>
<br />
<div id='tracks'>
  <div id='tag_list'>
    <ul>
      <li class="<%= @tag.nil? && 'active' %>">
        <%= link_to 'All', tracks_path %>
        <small>(<%= @all_tracks.size %>)</small>
      </li>
      <%- @tags.each do |tag| -%>
        <%- if tag.tracks.ordered.any? -%>
          <li class="<%= @tag == tag && 'active' %>">
            <%= link_to tag.name, tag_tracks_path(tag) %>
            <small>
              <%= link_to 'View', tag %>
              (<%= tag.tracks.size %>)
            </small>
          </li>
        <%- end -%>
      <%- end -%>
    </ul>
  </div>
  <div id='track_list'>
    <table>
      <tbody>
      <%- @tracks.each_with_index do |track, index| -%>
        <tr>
          <td><%= index + 1 %>.</td>
          <td><%= link_to track.name, @tag ? [@tag, track] : track %></td>
          <td><%= track.tag_name %></td>
          <td><%= format_distance track.distance %></td>
          <%- if user_signed_in? && @tag -%>
            <td class='action'><%= link_to image_tag('icon_up.png'), up_tag_tracks_path(@tag, track), method: :put, title: 'Up' %></td>
            <td class='action'><%= link_to image_tag('icon_down.png'), down_tag_tracks_path(@tag, track), method: :put, title: 'Down' %></td>
          <%- end -%>
          <td class='action'><%= link_to image_tag('icon_download.png'), track.attachment.url, title: 'gpx' %></td>
          <td class='action'><%= link_to image_tag('icon_edit.png'), @tag ? edit_tag_track_path(@tag, track) : edit_track_path(track), title: 'Edit' %></td>
          <td class='action'><%= link_to image_tag('icon_delete.png'), @tag ? tag_track_path(@tag, track) : track, method: :delete, confirm: 'Are you sure?', title: 'Delete' %></td>
        </tr>
      <%- end -%>
      </tbody>
    </table>
  </div>
</div>
